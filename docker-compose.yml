services:
  master:
    image: ros:noetic-ros-core
    command: roscore
    environment:
      DISPLAY: $DISPLAY
    network_mode: host
    restart: always
    privileged: true
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ~/.Xauthority:/root/.Xauthority

  cam0:
    build: .
    depends_on:
      - master
    environment:
      DISPLAY: $DISPLAY
    command: roslaunch --wait camera.launch name:=cam0 video_device:=/dev/video0
    network_mode: host
    privileged: true
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ~/.Xauthority:/root/.Xauthority
      - ./launch/camera.launch:/root/catkin_ws/camera.launch

  cam1:
    build: .
    depends_on:
      - master
    environment:
      DISPLAY: $DISPLAY
    command: roslaunch --wait camera.launch name:=cam1 video_device:=/dev/video2
    network_mode: host
    privileged: true
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ~/.Xauthority:/root/.Xauthority
      - ./launch/camera.launch:/root/catkin_ws/camera.launch

  perception:
    build: .
    depends_on:
      - master
    environment:
      DISPLAY: $DISPLAY
      PYTHONUNBUFFERED: 1
    command: roslaunch --wait perception.launch
    network_mode: host
    privileged: true
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ~/.Xauthority:/root/.Xauthority
      - ./perception:/root/catkin_ws/src/perception
      - ./launch/perception.launch:/root/catkin_ws/perception.launch

  control:
    build: .
    depends_on:
      - master
    environment:
      DISPLAY: $DISPLAY
      PYTHONUNBUFFERED: 1
    command: roslaunch --wait control.launch rate:=0.2
    network_mode: host
    privileged: true
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ~/.Xauthority:/root/.Xauthority
      - ./control:/root/catkin_ws/src/control
      - ./launch/control.launch:/root/catkin_ws/control.launch